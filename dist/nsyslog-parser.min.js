/*! nsyslog-parser 2018-08-06 */

"use strict";!function e(i,t,l){function a(s,n){if(!t[s]){if(!i[s]){var o="function"==typeof require&&require;if(!n&&o)return o(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=t[s]={exports:{}};i[s][0].call(d.exports,function(e){var t=i[s][1][e];return a(t||e)},d,d.exports,e,i,t,l)}return t[s].exports}for(var r="function"==typeof require&&require,s=0;s<l.length;s++)a(l[s]);return a}({1:[function(e,i,t){!function(i){var t=e("./parser.js");i.NSyslog=i.NSyslog||{},i.NSyslog.parse=t}(window)},{"./parser.js":3}],2:[function(e,i,t){function l(e){var i=[],t={},l=!1,a=7,r="";return e.split("").forEach(function(e){a?"|"==e?l?(l=!1,r+=e):(i.push(r),r="",a--):"\\"==e?(r+=e,l=!l):(l=!1,r+=e):r+=e}),r.length&&i.push(r),s.forEach(function(e,l){return t[e]=i[l]}),t}function a(e){var i=[],t={},l=null;do{if(l=r.exec(e)){var a=l[0],s=l.index;i.length&&(i[i.length-1]+=e.substring(0,s)),i.push(a),e=e.substring(s+a.length)}else e.length&&i.length&&(i[i.length-1]+=e,e="")}while(l&&e.length);return i.map(function(e){return e.trim()}).map(function(e){return e=e.split("="),{k:e.shift(),v:e.join("=")}}).forEach(function(e){t[e.k]=e.v}),t}var r=/[a-zA-Z][a-zA-Z0-9]+=/,s=["version","deviceVendor","deviceProduct","deviceVersion","deviceEventClassID","name","severity","extension"];i.exports={parse:function(e){var i=l(e);return{headers:i,fields:a(i.extension||"")}}}},{}],3:[function(e,i,t){function l(e){do{var i=e.shift();if(void 0===i)return i;i=i.trim()}while(!i);return i}function a(e,i){if(e.host)if(e.appName)if(e.pid){if(e.messageid)return!!e.structuredData||(e.structuredData=i.trim(),!1);e.messageid=i.trim()}else e.pid=i.trim();else e.appName=i.trim();else e.host=i.trim()}function r(e){var i=e.match(o.pri),t={originalMessage:e};if(i){t.pri=i[0],t.prival=parseInt(t.pri.match(o.prival)[1]);var r=s.get(t.prival);t.facilityval=r.facility,t.levelval=r.level,t.facility=s.FACILITY[r.facility].id,t.level=s.LEVEL[r.level].id}else t.pri="",t.prival=NaN;for(var c=e.substring(t.pri.length).split(" "),d=!1;e.length&&!d;){if((h=l(c)+" ").match(o.prinmr))t.version=parseInt(h),t.type="RFC5424",(h=l(c)+" ").match(o.ts)&&(t.ts=new Date(Date.parse(h.match(o.ts)[0].trim())));else if(h.match(o.month)){t.type="BSD";var u=h.trim(),f=l(c),p=l(c),m=(new Date).getYear()+1900;t.ts=new Date(Date.parse(m+" "+u+" "+f+" "+p))}else t.type="UNKNOWN",c.unshift(h.trim());d=!0}if(t.ts||(t.ts=new Date),t.type){var g=function(e){c.unshift(e),t.message=c.join(" "),d=!0};for(d=!1;e.length&&!d;){var h=l(c);if(h)if(h.endsWith(":")){var v=h.replace(/:$/,"").trim();v.match(o.invalid)?g(h):(a(t,v),t.message=c.join(" "),d=!0)}else if(c.length)if(h.match(o.invalid))g(h);else{var y=a(t,h.replace(/: $/,"").trim());!0===y?(c.unshift(h),t.message=c.join(" "),d=!0):!1===y&&(t.message=c.join(" "),d=!0)}else g(h);else d=!0}}else t.message=c.join(" ");if(t.chain=(t.host||"").split("/"),t.host=t.chain.pop(),"RFC5424"==t.type){var b=t.message.match(o.sdata)||[],E=0;t.structuredData=b.map(function(e){var i={},l=null;return E=t.message.indexOf(e)+e.length+1,e.replace(/(^\[)|(\]$)/g,"").split(" ").forEach(function(e,t){if(e.trim())if(0==t)i.$id=e;else{var a=e.split("=");a[0]&&a[1]&&'"'!=a[1]?(l=a.shift(),i[l]=a.join("=").replace(/\"/g,"")):a[0]&&void 0===a[1]?i[l]+=" "+(a[0]||"").replace(/\"/g,""):!a[0]||a[1].length&&'"'!=a[1]||(i[l]+=" "+(a[0]||"").replace(/\"/g,"")+"=")}}),i}),t.message=t.message.substring(E)}if(o.cef.test(t.message)){t.type="CEF";var x=n.parse(t.message);t.cef=x.headers,t.fields=x.fields}else{var w=[];t.message.split(",").forEach(function(e){var i=e.split("=");2==i.length&&(w[i[0]]=i[1])}),t.fields=w}return t.header=e.substring(0,e.length-t.message.length),t}var s=e("./pri.js"),n=e("./cef.js"),o={pri:/^<\d+>/,prinmr:/^\d+ /,prival:/<(\d+)>/,month:/^[a-zA-Z]{3} /,day:/^\d{1,2} /,time:/^\d+:\d+:\d+ /,ts:/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\S+ /,invalid:/[^a-zA-Z0-9\.\$\-_#%\/\[\]]/,sdata:/\[(\S+)( [^\=]+\=\"[^\"]+\")+\]/g,cef:/^CEF:\d+/};i.exports=function(e){try{return r(e)}catch(e){return{err:e}}}},{"./cef.js":2,"./pri.js":4}],4:[function(e,i,t){var l=[{id:"kern",label:"kernel messages"},{id:"user",label:"user-level messages"},{id:"mail",label:"mail system"},{id:"daemon",label:"system daemons"},{id:"auth",label:"security/authorization messages"},{id:"syslog",label:"messages generated internally by syslogd"},{id:"lpr",label:"line printer subsystem"},{id:"news",label:"network news subsystem"},{id:"uucp",label:"UUCP subsystem"},{id:"cron",label:"clock daemon"},{id:"authpriv",label:"security/authorization messages"},{id:"ftp",label:"FTP daemon"},{id:"ntp",label:"NTP subsystem"},{id:"security",label:"log audit"},{id:"console",label:"log alert"},{id:"solaris-cron",label:"clock daemon"},{id:"local0",label:"locally used facility 0"},{id:"local1",label:"locally used facility 0"},{id:"local2",label:"locally used facility 0"},{id:"local3",label:"locally used facility 0"},{id:"local4",label:"locally used facility 0"},{id:"local5",label:"locally used facility 0"},{id:"local6",label:"locally used facility 0"},{id:"local7",label:"locally used facility 0"}],a=[{id:"emerg",label:"system is unusable"},{id:"alert",label:"action must be taken immediately"},{id:"crit",label:"critical conditions"},{id:"error",label:"error conditions"},{id:"warn",label:"warning conditions"},{id:"notice",label:"normal but significant condition"},{id:"info",label:"informational messages"},{id:"debug",label:"debug-level messages"}],r=[],s=[];l.forEach(function(e,i){return r[e.id]=i}),a.forEach(function(e,i){return s[e.id]=i}),i.exports.LEVEL=a,i.exports.FACILITY=l,i.exports.LEVELS=s,i.exports.FACILITIES=r,i.exports.get=function(e,i){return"number"==typeof e&&void 0===i?{level:7&e,facility:e>>3}:"number"==typeof e&&"number"==typeof i?8*e+i:"string"==typeof e&&"number"==typeof i?8*(r[e]||0)+i:"number"==typeof e&&"string"==typeof i?8*e+(s[i]||0):"string"==typeof e&&"string"==typeof i?8*(r[e]||0)+(s[i]||0):{level:0,facility:0}}},{}]},{},[1]);